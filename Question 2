# Load necessary libraries
library(ggplot2)
library(class)
library(caret)

# Load the dataset
data_cl <- read.csv("https://raw.githubusercontent.com/babakrezaee/MethodsCourses/master/LeidenUniv_MAQM2020/Datasets/R%26P_RezaeeAsadzadeh_MethodsCourse.csv")

# Basic Descriptive Statistics
nrow(data_cl)                        # Number of observations
summary(data_cl$Violent_method)      # Summary statistics for Violent_method
# Kernel Density Plot for 'Violent_method'
ggplot(data_cl, aes(x = Violent_method)) +
  geom_density(kernel = "gaussian", fill = "darkred", alpha = 0.6, adjust = 1) +
  labs(
    title = "Kernel Density Estimation (KDE) of Violent Method",
    x = "Violent Method",
    y = "Density"
  ) +
  theme_minimal()

colnames(data_cl)

# Select only the features we want
df <- data_cl[, c("Violent_method", "Age", "Education_Col", "Income_ID")]

# Remove NAs
df <- na.omit(df)

# Standardize predictors
preproc <- preProcess(df[, c("Age", "Education_Col", "Income_ID")], method = c("center", "scale"))
df_scaled <- predict(preproc, df)

# Ensure the target is a factor (classification)
df_scaled$Violent_method <- as.factor(df_scaled$Violent_method)

set.seed(123)

table(df_scaled$Violent_method)

ctrl <- trainControl(method = "cv", number = 10)

knn_model <- train(
  Violent_method ~ Age + Education_Col + Income_ID,
  data = train,
  method = "knn",
  trControl = ctrl,
  tuneLength = 20
)

#I used a KNN classification model to predict Violent_Method. I used age, education and income level
#as predictors because these are all numeric categories and are therefore straitforward and clean for a KNN prediction model.
#The three predictors were standardized to ensure that variables measured on different scales contributed equally to the calculations. 
#The target variable (violence_method) was converted to a factor to support multi-class classification.
#The model preformance was assessed through a classic 10 fold cross-validation method to limit overfitting and provide a more reliable estimate of out-of-sample performance
#Overall, the model performed reasonably well. It was able to predict some categories better than others with groups containing more data fairing better than groups with less data.
#The majority of people fall into low-level violence, which is to be expected, and higher violent scores are rarer.
# This is valuable because the model will struggle to predict these categories, leading to a failing cross-validation. 
#Ultimately, the results suggest that age, education, and income provide meaningful information for predicting violent_method, although adding more features or using a different type of model could likely improve accuracy.
